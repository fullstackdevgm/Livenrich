!function($,window,document,undefined){"use strict";function Plugin(t,e){this.element=t,this.settings=$.extend(!0,{},default_settings,e),this.root=$(t),this.wrap=undefined,this.ui=undefined,this.shapeContainer=undefined,this.shapeSvgContainer=undefined,this.fullscreenTooltipsContainer=undefined,this.visibleFullscreenTooltip=undefined,this.visibleFullscreenTooltipIndex=undefined,this.bodyOverflow=undefined,this.highlightedShapes=new Array,this.connectedShapes=new Array,this.openedTooltips=new Array,this.apiHighlightedShapes=new Array,this.apiOpenedTooltips=new Array,this.touch=!1,this.fullscreenTooltipVisible=!1,this.init()}function hexToRgb(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function isPointInsideRect(t,e,i,s,n,o){return t>=i&&t<=i+n&&e>=s&&e<=s+o}function isPointInsidePolygon(t,e,i){for(var s=!1,n=0,o=i.length-1;n<i.length;o=n++){var a=i[n][0],p=i[n][1],l=i[o][0],h=i[o][1];p>e!=h>e&&t<(l-a)*(e-p)/(h-p)+a&&(s=!s)}return s}function isPointInsideEllipse(t,e,i,s,n,o){return(t-i)*(t-i)/(n*n)+(e-s)*(e-s)/(o*o)<=1}function fitRectToScreen(t,e,i,s){return t<0&&(t=0),e<0&&(e=0),t>$(document).width()-i&&(t=$(document).width()-i),e>$(document).height()-s&&(e=$(document).height()-s),{x:t,y:e}}function shuffle(t){for(var e,i,s=t.length;0!==s;)i=Math.floor(Math.random()*s),e=t[s-=1],t[s]=t[i],t[i]=e;return t}function isMobile(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}var fullscreenMap=undefined;$.imageMapProInitialized=function(t){},$.imageMapProEventHighlightedShape=function(t,e){},$.imageMapProEventUnhighlightedShape=function(t,e){},$.imageMapProEventClickedShape=function(t,e){},$.imageMapProEventOpenedTooltip=function(t,e){},$.imageMapProEventClosedTooltip=function(t,e){},$.imageMapProHighlightShape=function(t,e){var i=$('[data-shape-title="'+e+'"]').data("index"),s=instances[t].settings.spots[i];if(-1==instances[t].apiHighlightedShapes.indexOf(i)&&instances[t].apiHighlightedShapes.push(i),instances[t].connectedShapes[s.id])for(var n=0;n<instances[t].connectedShapes[s.id].length;n++){var o=instances[t].connectedShapes[s.id][n].index;-1==instances[t].apiHighlightedShapes.indexOf(o)&&instances[t].apiHighlightedShapes.push(o)}instances[t].highlightShape(i,!0)},$.imageMapProUnhighlightShape=function(t,e){var i=$('[data-shape-title="'+e+'"]').data("index"),s=instances[t].settings.spots[i];if(-1!=instances[t].apiHighlightedShapes.indexOf(i)){var n=instances[t].apiHighlightedShapes.indexOf(i);instances[t].apiHighlightedShapes.splice(n,1)}if(instances[t].connectedShapes[s.id])for(var o=0;o<instances[t].connectedShapes[s.id].length;o++){var a=instances[t].connectedShapes[s.id][o].index,p=instances[t].apiHighlightedShapes.indexOf(a);instances[t].apiHighlightedShapes.splice(p,1),instances[t].unhighlightShape(a)}instances[t].unhighlightShape(i)},$.imageMapProOpenTooltip=function(t,e){var i=$('[data-shape-title="'+e+'"]').data("index");instances[t].showTooltip(i),instances[t].updateTooltipPosition(i),-1==instances[t].apiOpenedTooltips.indexOf(i)&&instances[t].apiOpenedTooltips.push(i)},$.imageMapProHideTooltip=function(t,e){var i=$('[data-shape-title="'+e+'"]').data("index");if(-1!=instances[t].apiOpenedTooltips.indexOf(i)){var s=instances[t].apiOpenedTooltips.indexOf(i);instances[t].apiOpenedTooltips.splice(s,1)}instances[t].hideTooltip(i)},$.imageMapProReInitMap=function(t){instances[t].init()},$.imageMapProIsMobile=function(){return isMobile()};var pluginName="imageMapPro",default_settings=$.imageMapProEditorDefaults,default_spot_settings=$.imageMapProShapeDefaults,instances=new Array;$.extend(Plugin.prototype,{init:function(){var t=this;t.parseSettings(),instances[this.settings.general.name]=this,this.id=100*Math.random();for(var e=0;e<t.settings.spots.length;e++){var i=t.settings.spots[e],s=$.extend(!0,{},default_spot_settings);i=$.extend(!0,s,i),t.settings.spots[e]=$.extend(!0,{},i),t.settings.spots[e].title&&0!=t.settings.spots[e].title.length||(t.settings.spots[e].title=t.settings.spots[e].id),""!=i.connected_to&&(this.connectedShapes[i.connected_to]||(this.connectedShapes[i.connected_to]=new Array),this.connectedShapes[i.connected_to].push({id:i.id,index:e}))}var n=new Image;n.src=t.settings.image.url,t.loadImage(n,function(){},function(){var e="";t.root.addClass("imp-initialized"),t.root.attr("data-image-map-pro-id",t.settings.id),t.root.html('<div class="imp-wrap"></div>'),t.wrap=t.root.find(".imp-wrap"),e+='<img src="'+t.settings.image.url+'">',t.wrap.html(e),t.centerImageMap(),t.adjustSize(),t.drawShapes(),t.addTooltips(),t.initFullscreen(),t.events(),t.APIEvents(),t.animateShapesLoop(),$.imageMapProInitialized(t.settings.general.name)}),$(window).on("resize",function(){t.openedTooltips.length>0&&t.updateTooltipPosition(t.openedTooltips[t.openedTooltips.length-1])})},parseSettings:function(){this.settings.general.image_url&&(this.settings.image.url=this.settings.general.image_url)},loadImage:function(t,e,i){t.complete&&t.naturalWidth!==undefined&&t.naturalHeight!==undefined?i():(e(),$(t).on("load",function(){$(t).off("load"),i()}))},centerImageMap:function(){var t=this;1==parseInt(t.settings.general.center_image_map,10)&&t.wrap.css({margin:"0 auto"})},adjustSize:function(){var t=this;if(1==parseInt(t.settings.runtime.is_fullscreen,10)){var e=$(window).width()/$(window).height(),i=t.settings.general.width/t.settings.general.height;return i<e?(t.settings.general.width=$(window).height()*i,t.settings.general.height=$(window).height()):(t.settings.general.width=$(window).width(),t.settings.general.height=$(window).width()/i),void t.wrap.css({width:t.settings.general.width,height:t.settings.general.height})}if(1==parseInt(t.settings.general.responsive,10)){if(1==parseInt(t.settings.general.preserve_quality,10)){t.settings.general.naturalWidth||t.settings.general.width;t.wrap.css({"max-width":t.settings.general.naturalWidth})}}else t.wrap.css({width:t.settings.general.width,height:t.settings.general.height})},drawShapes:function(){for(var t=this,e=0;e<t.settings.spots.length;e++)if((a=t.settings.spots[e]).x=parseFloat(a.x),a.y=parseFloat(a.y),a.width=parseFloat(a.width),a.height=parseFloat(a.height),a.default_style.stroke_width=parseInt(a.default_style.stroke_width),a.mouseover_style.stroke_width=parseInt(a.mouseover_style.stroke_width),"poly"==a.type)for(d=0;d<a.points.length;d++)a.points[d].x=parseFloat(a.points[d].x),a.points[d].y=parseFloat(a.points[d].y);t.settings.general.width=parseInt(t.settings.general.width),t.settings.general.height=parseInt(t.settings.general.height),t.wrap.prepend('<div class="imp-shape-container"></div>'),t.shapeContainer=t.wrap.find(".imp-shape-container");var i="",s=t.settings.general.width,n=t.settings.general.height;1==parseInt(t.settings.general.responsive,10)&&(s=t.settings.general.naturalWidth,n=t.settings.general.naturalHeight);for(var o='<svg class="hs-poly-svg" viewBox="0 0 '+s+" "+n+'" preserveAspectRatio="none">',e=0;e<t.settings.spots.length;e++){var a=t.settings.spots[e],p=this.calcStyles(a.default_style,e);if("spot"==a.type)if(1==parseInt(a.default_style.use_icon,10)){if(i+='<div class="imp-shape imp-shape-spot" id="'+a.id+'" data-shape-title="'+a.title+'" style="'+p+'" data-index='+e+">","library"==a.default_style.icon_type?(i+='   <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="'+a.default_style.icon_svg_viewbox+'" xml:space="preserve" width="'+a.width+'px" height="'+a.height+'px">',i+='       <path style="fill:'+a.default_style.icon_fill+'" d="'+a.default_style.icon_svg_path+'"></path>',i+="   </svg>"):i+='<img src="'+a.default_style.icon_url+'" style="width: '+a.width+"px; height: "+a.height+'px">',1==parseInt(a.default_style.icon_shadow,10)){var l="";l+="width: "+a.width+"px;",l+="height: "+a.height+"px;",i+='<div style="'+(l+="top: "+a.height/2+"px;")+'" class="imp-shape-icon-shadow"></div>'}i+="</div>"}else i+='<div class="imp-shape imp-shape-spot" id="'+a.id+'" data-shape-title="'+a.title+'" style="'+p+'" data-index='+e+"></div>";if("rect"==a.type&&(i+='<div class="imp-shape imp-shape-rect" id="'+a.id+'" data-shape-title="'+a.title+'" style="'+p+'" data-index='+e+"></div>"),"oval"==a.type&&(i+='<div class="imp-shape imp-shape-oval" id="'+a.id+'" data-shape-title="'+a.title+'" style="'+p+'" data-index='+e+"></div>"),"poly"==a.type){o+='<polygon class="imp-shape imp-shape-poly" style="'+p+'" data-index='+e+' id="'+a.id+'" data-shape-title="'+a.title+'" points="';var h=s*(a.width/100),r=n*(a.height/100);a.vs=new Array;for(var d=0;d<a.points.length;d++){var g=s*(a.x/100)+a.points[d].x/100*h,c=n*(a.y/100)+a.points[d].y/100*r;o+=g+","+c+" ",a.vs.push([g,c])}o+='"></polygon>'}}o+="</svg>",t.shapeContainer.html(i+o)},addTooltips:function(){var t=this;if("always"==t.settings.tooltips.fullscreen_tooltips||"mobile-only"==t.settings.tooltips.fullscreen_tooltips&&isMobile()){t.fullscreenTooltipsContainer||($('.imp-fullscreen-tooltips-container[data-image-map-id="'+t.settings.id+'"]').remove(),$("body").prepend('<div class="imp-fullscreen-tooltips-container" data-image-map-id="'+t.settings.id+'"></div>'),t.fullscreenTooltipsContainer=$('.imp-fullscreen-tooltips-container[data-image-map-id="'+t.settings.id+'"]'));for(var e="",i=0;i<t.settings.spots.length;i++){(o=t.settings.spots[i]).tooltip_content.plain_text=o.tooltip_content.plain_text.replace(/\n/g,"<br>");var s="",n=hexToRgb(o.tooltip_style.background_color)||{r:0,b:0,g:0};if(s+="padding: "+o.tooltip_style.padding+"px;",s+="background: rgba("+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+");","none"==t.settings.tooltips.tooltip_animation&&(s+="opacity: 0;"),"fade"==t.settings.tooltips.tooltip_animation&&(s+="opacity: 0;",s+="transition-property: opacity;-moz-transition-property: opacity;-webkit-transition-property: opacity;"),"grow"==t.settings.tooltips.tooltip_animation&&(s+="transform: scale(0, 0);-moz-transform: scale(0, 0);-webkit-transform: scale(0, 0);",s+="transition-property: transform;-moz-transition-property: -moz-transform;-webkit-transition-property: -webkit-transform;",s+="transform-origin: 50% 50%;-moz-transform-origin: 50% 50%;-webkit-transform-origin: 50% 50%;"),e+='<div class="imp-fullscreen-tooltip" style="'+s+'" data-index="'+i+'">',e+='   <div class="imp-tooltip-close-button" data-index="'+i+'"><i class="fa fa-times" aria-hidden="true"></i></div>',"plain-text"==o.tooltip_content.content_type){s="";e+='<div class="imp-tooltip-plain-text" style="'+(s+="color: "+o.tooltip_content.plain_text_color+";")+'">'+o.tooltip_content.plain_text+"</div>"}else o.tooltip_content.squares_json?e+=$.squaresRendererRenderObject(o.tooltip_content.squares_json):e+=$.squaresRendererRenderObject(o.tooltip_content.squares_settings);e+="</div>"}t.fullscreenTooltipsContainer.html(e)}else{for(var e="",i=0;i<t.settings.spots.length;i++){var o=t.settings.spots[i];o.tooltip_content.plain_text=o.tooltip_content.plain_text.replace(/\n/g,"<br>");var s="",n=hexToRgb(o.tooltip_style.background_color)||{r:0,b:0,g:0};if(s+="border-radius: "+o.tooltip_style.border_radius+"px;",s+="padding: "+o.tooltip_style.padding+"px;",s+="background: rgba("+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+");","none"==t.settings.tooltips.tooltip_animation&&(s+="opacity: 0;"),"fade"==t.settings.tooltips.tooltip_animation&&(s+="opacity: 0;",s+="transition-property: opacity;-moz-transition-property: opacity;-webkit-transition-property: opacity;"),"grow"==t.settings.tooltips.tooltip_animation&&(s+="transform: scale(0, 0);-moz-transform: scale(0, 0);-webkit-transform: scale(0, 0);",s+="transition-property: transform;-moz-transition-property: -moz-transform;-webkit-transition-property: -webkit-transform;","top"==o.tooltip_style.position&&(s+="transform-origin: 50% 100%;-moz-transform-origin: 50% 100%;-webkit-transform-origin: 50% 100%;"),"bottom"==o.tooltip_style.position&&(s+="transform-origin: 50% 0%;-moz-transform-origin: 50% 0%;-webkit-transform-origin: 50% 0%;"),"left"==o.tooltip_style.position&&(s+="transform-origin: 100% 50%;-moz-transform-origin: 100% 50%;-webkit-transform-origin: 100% 50%;"),"right"==o.tooltip_style.position&&(s+="transform-origin: 0% 50%;-moz-transform-origin: 0% 50%;-webkit-transform-origin: 0% 50%;")),e+='<div class="imp-tooltip" style="'+s+'" data-index="'+i+'">',"top"==o.tooltip_style.position&&(e+='   <div class="hs-arrow hs-arrow-bottom" style="border-top-color: rgba('+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+');"></div>'),"bottom"==o.tooltip_style.position&&(e+='   <div class="hs-arrow hs-arrow-top" style="border-bottom-color: rgba('+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+');"></div>'),"left"==o.tooltip_style.position&&(e+='   <div class="hs-arrow hs-arrow-right" style="border-left-color: rgba('+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+');"></div>'),"right"==o.tooltip_style.position&&(e+='   <div class="hs-arrow hs-arrow-left" style="border-right-color: rgba('+n.r+", "+n.g+", "+n.b+", "+o.tooltip_style.background_opacity+');"></div>'),"plain-text"==o.tooltip_content.content_type){s="";e+='<div class="imp-tooltip-plain-text" style="'+(s+="color: "+o.tooltip_content.plain_text_color+";")+'">'+o.tooltip_content.plain_text+"</div>"}else o.tooltip_content.squares_json?e+=$.squaresRendererRenderObject(o.tooltip_content.squares_json):e+=$.squaresRendererRenderObject(o.tooltip_content.squares_settings);e+="</div>"}t.wrap.prepend(e)}},initFullscreen:function(){var t=this;if(1==parseInt(t.settings.fullscreen.enable_fullscreen_mode,10)){var e="";e+="background: "+t.settings.fullscreen.fullscreen_button_color+"; ",e+="color: "+t.settings.fullscreen.fullscreen_button_text_color+"; ";var i='<i class="fa fa-arrows-alt" aria-hidden="true"></i>';1==parseInt(t.settings.runtime.is_fullscreen,10)&&(i='<i class="fa fa-times" aria-hidden="true"></i>');var s="Go Fullscreen";1==parseInt(t.settings.runtime.is_fullscreen,10)&&(s="Close Fullscreen");var n="";"icon"==t.settings.fullscreen.fullscreen_button_type&&(n+=i),"text"==t.settings.fullscreen.fullscreen_button_type&&(n+=s),"icon_and_text"==t.settings.fullscreen.fullscreen_button_type&&(n+=i+" "+s);var o="";"icon"==t.settings.fullscreen.fullscreen_button_type&&(o+="imp-fullscreen-button-icon-only");var a="";a+='<div style="'+e+'" class="'+o+" imp-fullscreen-button imp-fullscreen-button-position-"+t.settings.fullscreen.fullscreen_button_position+'">',a+=n,a+="</div>",t.wrap.append('<div class="imp-ui"></div>'),t.ui=t.wrap.find(".imp-ui"),t.ui.append(a);var p=t.ui.find(".imp-fullscreen-button");1!=parseInt(t.settings.fullscreen.fullscreen_button_position,10)&&4!=parseInt(t.settings.fullscreen.fullscreen_button_position,10)||p.css({"margin-left":-p.outerWidth()/2}),1==parseInt(t.settings.fullscreen.start_in_fullscreen_mode,10)&&0==t.settings.runtime.is_fullscreen&&t.toggleFullscreen()}},measureTooltipSize:function(t){if(!("always"==this.settings.tooltips.fullscreen_tooltips||"mobile"==this.settings.tooltips.fullscreen_tooltips&&isMobile())){var e=this.settings.spots[t],i=this.wrap.find('.imp-tooltip[data-index="'+t+'"]');0==parseInt(e.tooltip_style.auto_width,10)&&i.css({width:e.tooltip_style.width}),i.data("imp-measured-width",i.outerWidth()),i.data("imp-measured-height",i.outerHeight())}},animateShapesLoop:function(){if("none"!=this.settings.general.pageload_animation)for(var t=750/this.settings.spots.length,e=shuffle(this.settings.spots.slice()),i=0;i<e.length;i++)this.animateShape(e[i],t*i)},animateShape:function(t,e){var i=this,s=$("#"+t.id);setTimeout(function(){"fade"==i.settings.general.pageload_animation&&s.css({opacity:t.default_style.opacity}),"grow"==i.settings.general.pageload_animation&&s.css({transform:"scale(1, 1)","-moz-transform":"scale(1, 1)","-webkit-transform":"scale(1, 1)"})},e)},events:function(){var t=this;this.wrap.off("mousemove"),this.wrap.on("mousemove",function(e){t.touch||t.handleEventMove(e)}),this.wrap.off("mouseup"),this.wrap.on("mouseup",function(e){t.touch||t.handleEventEnd(e)}),this.wrap.off("touchstart"),this.wrap.on("touchstart",function(e){t.touch=!0,t.handleEventMove(e)}),this.wrap.off("touchmove"),this.wrap.on("touchmove",function(e){t.handleEventMove(e)}),this.wrap.off("touchend"),this.wrap.on("touchend",function(e){t.handleEventEnd(e)}),$(document).off("mousemove."+this.settings.id),$(document).on("mousemove."+this.settings.id,function(e){t.touch||0!=$(e.target).closest(".imp-wrap").length&&0!=$(e.target).closest('[data-image-map-pro-id="'+t.settings.id+'"]').length||0!=$(e.target).closest(".imp-fullscreen-tooltips-container").length||("mouseover"==t.settings.tooltips.show_tooltips&&0==$(e.target).closest("[data-imp-open-tooltip-on-mouseover]").length&&0==$(e.target).closest("[data-imp-trigger-shape-on-mouseover]").length&&t.hideAllTooltips(),0==$(e.target).closest("[data-imp-highlight-shape-on-mouseover]").length&&0==$(e.target).closest("[data-imp-trigger-shape-on-mouseover]").length&&t.unhighlightAllShapes())}),$(document).off("touchstart."+this.settings.id),$(document).on("touchstart."+this.settings.id,function(e){0!=$(e.target).closest(".imp-wrap").length&&0!=$(e.target).closest('[data-image-map-pro-id="'+t.settings.id+'"]').length||0!=$(e.target).closest(".imp-fullscreen-tooltips-container").length||("mouseover"==t.settings.tooltips.show_tooltips&&0==$(e.target).closest("[data-imp-open-tooltip-on-mouseover]").length&&0==$(e.target).closest("[data-imp-trigger-shape-on-mouseover]").length&&t.hideAllTooltips(),0==$(e.target).closest("[data-imp-highlight-shape-on-mouseover]").length&&0==$(e.target).closest("[data-imp-trigger-shape-on-mouseover]").length&&t.unhighlightAllShapes())}),$(document).off("mouseup."+this.settings.id),$(document).on("mouseup."+this.settings.id,function(e){t.touch||0!=$(e.target).closest(".imp-wrap").length&&0!=$(e.target).closest('[data-image-map-pro-id="'+t.settings.id+'"]').length||0!=$(e.target).closest(".imp-fullscreen-tooltips-container").length||("click"==t.settings.tooltips.show_tooltips&&t.hideAllTooltips(),t.unhighlightAllShapes())}),$(document).off("touchend."+this.settings.id),$(document).on("touchend."+this.settings.id,function(e){0!=$(e.target).closest(".imp-wrap").length&&0!=$(e.target).closest('[data-image-map-pro-id="'+t.settings.id+'"]').length||0!=$(e.target).closest(".imp-fullscreen-tooltips-container").length||("click"==t.settings.tooltips.show_tooltips&&t.hideAllTooltips(),t.unhighlightAllShapes())}),$(document).off("click."+this.settings.id,".imp-tooltip-close-button"),$(document).on("click."+this.settings.id,".imp-tooltip-close-button",function(){t.hideAllTooltips()}),$(document).off("click."+this.settings.id,'[data-image-map-pro-id="'+this.settings.id+'"] .imp-fullscreen-button'),$(document).on("click."+this.settings.id,'[data-image-map-pro-id="'+this.settings.id+'"] .imp-fullscreen-button',function(){t.toggleFullscreen()})},APIEvents:function(){var t=this;$(document).on("mouseover","[data-imp-highlight-shape-on-mouseover]",function(){var e=$(this).data("imp-highlight-shape-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");t.highlightShape(s,!0)}}),$(document).on("mouseout","[data-imp-highlight-shape-on-mouseover]",function(){$(this).data("imp-highlight-shape-on-mouseover");var e=$(this).data("imp-image-map-name");e||(e=t.settings.general.name),e==t.settings.general.name&&t.unhighlightAllShapes()}),$(document).on("click","[data-imp-highlight-shape-on-click]",function(){var e=$(this).data("imp-highlight-shape-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(t.highlightShape(s,!0),-1==instances[i].apiHighlightedShapes.indexOf(s)&&instances[i].apiHighlightedShapes.push(s),instances[i].connectedShapes[n.id])for(var o=0;o<instances[i].connectedShapes[n.id].length;o++){var a=instances[i].connectedShapes[n.id][o].index;-1==instances[i].apiHighlightedShapes.indexOf(a)&&instances[i].apiHighlightedShapes.push(a)}}}),$(document).on("mouseover","[data-imp-unhighlight-shape-on-mouseover]",function(){var e=$(this).data("imp-unhighlight-shape-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(-1!=instances[i].apiHighlightedShapes.indexOf(s)){var o=instances[i].apiHighlightedShapes.indexOf(s);instances[i].apiHighlightedShapes.splice(o,1)}if(instances[i].connectedShapes[n.id])for(var a=0;a<instances[i].connectedShapes[n.id].length;a++){var p=instances[i].connectedShapes[n.id][a].index,l=instances[i].apiHighlightedShapes.indexOf(p);instances[i].apiHighlightedShapes.splice(l,1),instances[i].unhighlightShape(p)}t.unhighlightShape(s)}}),$(document).on("click","[data-imp-unhighlight-shape-on-click]",function(){var e=$(this).data("imp-unhighlight-shape-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(-1!=instances[i].apiHighlightedShapes.indexOf(s)){var o=instances[i].apiHighlightedShapes.indexOf(s);instances[i].apiHighlightedShapes.splice(o,1)}if(instances[i].connectedShapes[n.id])for(var a=0;a<instances[i].connectedShapes[n.id].length;a++){var p=instances[i].connectedShapes[n.id][a].index,l=instances[i].apiHighlightedShapes.indexOf(p);instances[i].apiHighlightedShapes.splice(l,1),instances[i].unhighlightShape(p)}t.unhighlightShape(s)}}),$(document).on("mouseover","[data-imp-open-tooltip-on-mouseover]",function(){var e=$(this).data("imp-open-tooltip-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");t.showTooltip(s),t.updateTooltipPosition(s)}}),$(document).on("mouseout","[data-imp-open-tooltip-on-mouseover]",function(){$(this).data("imp-open-tooltip-on-mouseover");var e=$(this).data("imp-image-map-name");e||(e=t.settings.general.name),e==t.settings.general.name&&t.hideAllTooltips()}),$(document).on("click","[data-imp-open-tooltip-on-click]",function(){var e=$(this).data("imp-open-tooltip-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");t.showTooltip(s),t.updateTooltipPosition(s),-1==instances[i].apiOpenedTooltips.indexOf(s)&&instances[i].apiOpenedTooltips.push(s)}}),$(document).on("mouseover","[data-imp-close-tooltip-on-mouseover]",function(){var e=$(this).data("imp-close-tooltip-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");if(-1!=instances[i].apiOpenedTooltips.indexOf(s)){var n=instances[i].apiOpenedTooltips.indexOf(s);instances[i].apiOpenedTooltips.splice(n,1)}t.hideTooltip(s)}}),$(document).on("click","[data-imp-close-tooltip-on-click]",function(){var e=$(this).data("imp-close-tooltip-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");if(-1!=instances[i].apiOpenedTooltips.indexOf(s)){var n=instances[i].apiOpenedTooltips.indexOf(s);instances[i].apiOpenedTooltips.splice(n,1)}t.hideTooltip(s)}}),$(document).on("mouseover","[data-imp-trigger-shape-on-mouseover]",function(){var e=$(this).data("imp-trigger-shape-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index");t.highlightShape(s,!0),t.showTooltip(s),t.updateTooltipPosition(s)}}),$(document).on("mouseout","[data-imp-trigger-shape-on-mouseover]",function(){$(this).data("imp-trigger-shape-on-mouseover");var e=$(this).data("imp-image-map-name");e||(e=t.settings.general.name),e==t.settings.general.name&&(t.unhighlightAllShapes(),t.hideAllTooltips())}),$(document).on("click","[data-imp-trigger-shape-on-click]",function(){var e=$(this).data("imp-trigger-shape-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(t.highlightShape(s,!0),t.showTooltip(s),t.updateTooltipPosition(s),-1==instances[i].apiOpenedTooltips.indexOf(s)&&instances[i].apiOpenedTooltips.push(s),-1==instances[i].apiHighlightedShapes.indexOf(s)&&instances[i].apiHighlightedShapes.push(s),instances[i].connectedShapes[n.id])for(var o=0;o<instances[i].connectedShapes[n.id].length;o++){var a=instances[i].connectedShapes[n.id][o].index;-1==instances[i].apiHighlightedShapes.indexOf(a)&&instances[i].apiHighlightedShapes.push(a)}}}),$(document).on("mouseover","[data-imp-untrigger-shape-on-mouseover]",function(){var e=$(this).data("imp-untrigger-shape-on-mouseover"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(-1!=instances[i].apiHighlightedShapes.indexOf(s)){l=instances[i].apiHighlightedShapes.indexOf(s);instances[i].apiHighlightedShapes.splice(l,1)}if(instances[i].connectedShapes[n.id])for(var o=0;o<instances[i].connectedShapes[n.id].length;o++){var a=instances[i].connectedShapes[n.id][o].index,p=instances[i].apiHighlightedShapes.indexOf(a);instances[i].apiHighlightedShapes.splice(p,1),instances[i].unhighlightShape(a)}if(t.unhighlightShape(s),-1!=instances[i].apiOpenedTooltips.indexOf(s)){var l=instances[i].apiOpenedTooltips.indexOf(s);instances[i].apiOpenedTooltips.splice(l,1)}t.hideTooltip(s)}}),$(document).on("click","[data-imp-untrigger-shape-on-click]",function(){var e=$(this).data("imp-untrigger-shape-on-click"),i=$(this).data("imp-image-map-name");if(i||(i=t.settings.general.name),i==t.settings.general.name){var s=$('[data-shape-title="'+e+'"]').data("index"),n=t.settings.spots[s];if(-1!=instances[i].apiHighlightedShapes.indexOf(s)){l=instances[i].apiHighlightedShapes.indexOf(s);instances[i].apiHighlightedShapes.splice(l,1)}if(instances[i].connectedShapes[n.id])for(var o=0;o<instances[i].connectedShapes[n.id].length;o++){var a=instances[i].connectedShapes[n.id][o].index,p=instances[i].apiHighlightedShapes.indexOf(a);instances[i].apiHighlightedShapes.splice(p,1),instances[i].unhighlightShape(a)}if(t.unhighlightShape(s),-1!=instances[i].apiOpenedTooltips.indexOf(s)){var l=instances[i].apiOpenedTooltips.indexOf(s);instances[i].apiOpenedTooltips.splice(l,1)}t.hideTooltip(s)}})},disableEvents:function(){this.wrap.off("mousemove"),this.wrap.off("mouseup"),this.wrap.off("touchstart"),this.wrap.off("touchmove"),this.wrap.off("touchend"),$(document).off("mousemove."+this.settings.id),$(document).off("touchstart."+this.settings.id),$(document).off("click."+this.settings.id,".imp-tooltip-close-button"),$(document).off("click."+this.settings.id,".imp-fullscreen-button")},handleEventMove:function(t){if(!this.fullscreenTooltipVisible){var e=this.getEventRelativeCoordinates(t),i=this.matchShapeToCoords(e);this.isPointInsideVisibleTooltip(e)&&0==parseInt(this.settings.tooltips.sticky_tooltips,10)||(-1!=i&&(this.isShapeHighlighted(i)||(this.unhighlightAllShapes(),"mouseover"==this.settings.tooltips.show_tooltips&&this.hideAllTooltips(),this.highlightShape(i,!0)),"mouseover"==this.settings.tooltips.show_tooltips&&1==parseInt(this.settings.tooltips.enable_tooltips,10)&&1==parseInt(this.settings.spots[i].tooltip_style.enable_tooltip,10)&&this.showTooltip(i),this.openedTooltips.length>0&&1==parseInt(this.settings.tooltips.sticky_tooltips,10)&&"mouseover"==this.settings.tooltips.show_tooltips&&this.updateTooltipPosition(this.openedTooltips[this.openedTooltips.length-1],t)),-1==i&&(this.unhighlightAllShapes(),"mouseover"==this.settings.tooltips.show_tooltips&&this.hideAllTooltips()))}},handleEventEnd:function(t){if(0==$(t.target).closest(".imp-tooltip").length&&!this.fullscreenTooltipVisible){var e=this.getEventRelativeCoordinates(t),i=this.matchShapeToCoords(e);-1!=i&&("click"==this.settings.tooltips.show_tooltips&&1==parseInt(this.settings.tooltips.enable_tooltips,10)&&1==parseInt(this.settings.spots[i].tooltip_style.enable_tooltip,10)&&this.showTooltip(i),this.performClickAction(i)),-1==i&&"click"==this.settings.tooltips.show_tooltips&&this.hideAllTooltips()}},getEventRelativeCoordinates:function(t){var e,i;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var s=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e=s.pageX,i=s.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e=t.pageX,i=t.pageY);return e-=this.wrap.offset().left,i-=this.wrap.offset().top,e=e/this.wrap.width()*100,i=i/this.wrap.height()*100,{x:e,y:i}},getEventCoordinates:function(t){var e,i;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var s=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e=s.pageX,i=s.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e=t.pageX,i=t.pageY);return{x:e,y:i}},matchShapeToCoords:function(t){for(var e=this.settings.spots.length-1;e>=0;e--){var i=this.settings.spots[e];if("poly"==i.type){var s=t.x/100*this.wrap.width(),n=t.y/100*this.wrap.height();if(s=s*this.settings.general.width/this.wrap.width(),n=n*this.settings.general.height/this.wrap.height(),isPointInsidePolygon(s,n,i.vs))return e}if("spot"==i.type){var o=i.width<44?44:i.width,a=i.height<44?44:i.height,s=t.x/100*this.wrap.width(),n=t.y/100*this.wrap.height(),p=i.x/100*this.wrap.width()-o/2,l=i.y/100*this.wrap.height()-a/2,h=o,r=a;if(1==parseInt(i.default_style.icon_is_pin,10)&&1==parseInt(i.default_style.use_icon,10)&&(l-=a/2,i.height<44&&(l+=i.height/2)),isPointInsideRect(s,n,p,l,h,r))return e}if("rect"==i.type&&isPointInsideRect(t.x,t.y,i.x,i.y,i.width,i.height))return e;if("oval"==i.type&&isPointInsideEllipse(s=t.x,n=t.y,i.x+i.width/2,i.y+i.height/2,p=i.width/2,l=i.height/2))return e}return-1},isPointInsideVisibleTooltip:function(t){for(var e=0;e<this.openedTooltips.length;e++){var i=this.wrap.find('.imp-tooltip[data-index="'+this.openedTooltips[e]+'"]'),s=this.openedTooltips[e],n=this.settings.spots[s].tooltip_style.buffer,o=i.outerWidth(),a=i.outerHeight(),p=i.offset().left-this.wrap.offset().left,l=i.offset().top-this.wrap.offset().top;p=p/this.wrap.width()*100,l=l/this.wrap.height()*100,o=o/this.wrap.width()*100,a=a/this.wrap.height()*100;h=[];if("left"==this.settings.spots[s].tooltip_style.position)h=[[p,l],[p+o,l],[p+o+(n=n/this.wrap.width()*100),l+a-a/3-a/3],[p+o+n,l+a-a/3],[p+o,l+a],[p,l+a]];if("right"==this.settings.spots[s].tooltip_style.position)h=[[p,l],[p+o,l],[p+o,l+a],[p,l+a],[p-(n=n/this.wrap.width()*100),l+a-a/3],[p-n,l+a-a/3-a/3]];if("top"==this.settings.spots[s].tooltip_style.position)h=[[p,l],[p+o,l],[p+o,l+a],[p+o-o/3,l+a+(n=n/this.wrap.height()*100)],[p+o-o/3-o/3,l+a+n],[p,l+a]];if("bottom"==this.settings.spots[s].tooltip_style.position)var h=[[p,l],[p+o-o/3-o/3,l-(n=n/this.wrap.height()*100)],[p+o-o/3,l-n],[p+o,l],[p+o,l+a],[p,l+a]];return!!isPointInsidePolygon(t.x,t.y,h)}},getIndexOfShapeWithID:function(t){for(var e=0;e<this.settings.spots.length;e++)if(this.settings.spots[e].id==t)return e},calcStyles:function(t,e){var i=this.settings.spots[e],s="";if("spot"==i.type){s+="left: "+i.x+"%;",s+="top: "+i.y+"%;",s+="width: "+i.width+"px;",s+="height: "+i.height+"px;",s+="opacity: "+t.opacity+";";var n=-i.width/2,o=-i.height/2;if(0==parseInt(i.default_style.use_icon,10)){var a=hexToRgb(t.background_color)||{r:0,b:0,g:0},p=hexToRgb(t.border_color)||{r:0,b:0,g:0};s+="border-radius: "+t.border_radius+"px;",s+="background: rgba("+a.r+", "+a.g+", "+a.b+", "+t.background_opacity+");",s+="border-width: "+t.border_width+"px;",s+="border-style: "+t.border_style+";",s+="border-color: rgba("+p.r+", "+p.g+", "+p.b+", "+t.border_opacity+");"}1==parseInt(i.default_style.use_icon,10)&&1==parseInt(i.default_style.icon_is_pin,10)&&(n=-i.height),s+="margin-left: "+o+"px;",s+="margin-top: "+n+"px;"}if("rect"==i.type||"oval"==i.type){var l=t.border_radius+"px";"oval"==i.type&&(l="50% 50%");var a=hexToRgb(t.background_color)||{r:0,b:0,g:0},p=hexToRgb(t.border_color)||{r:0,b:0,g:0};s+="left: "+i.x+"%;",s+="top: "+i.y+"%;",s+="width: "+i.width+"%;",s+="height: "+i.height+"%;",s+="opacity: "+t.opacity+";",s+="background: rgba("+a.r+", "+a.g+", "+a.b+", "+t.background_opacity+");",s+="border-width: "+t.border_width+"px;",s+="border-style: "+t.border_style+";",s+="border-color: rgba("+p.r+", "+p.g+", "+p.b+", "+t.border_opacity+");",s+="border-radius: "+l+";"}if("poly"==i.type){var h=hexToRgb(t.fill)||{r:0,b:0,g:0},r=hexToRgb(t.stroke_color)||{r:0,b:0,g:0};s+="opacity: "+t.opacity+";",s+="fill: rgba("+h.r+", "+h.g+", "+h.b+", "+t.fill_opacity+");",s+="stroke: rgba("+r.r+", "+r.g+", "+r.b+", "+t.stroke_opacity+");",s+="stroke-width: "+t.stroke_width+"px;",s+="stroke-dasharray: "+t.stroke_dasharray+";",s+="stroke-linecap: "+t.stroke_linecap+";"}return s},applyStyles:function(t,e){var i=this.settings.spots[e],s=this.wrap.find("#"+i.id),n=this.calcStyles(t,e);s.attr("style",n),"spot"==i.type&&s.find("path").length>0&&s.find("path").attr("style","fill:"+t.icon_fill)},highlightShape:function(t,e){var i=this.settings.spots[t];if(e&&""!=i.connected_to){n=this.getIndexOfShapeWithID(i.connected_to);this.highlightShape(n,!0)}else{if(this.connectedShapes[i.id])for(var s=0;s<this.connectedShapes[i.id].length;s++){var n=this.connectedShapes[i.id][s].index;this.highlightShape(n,!1)}this.applyStyles(this.settings.spots[t].mouseover_style,t),$.imageMapProEventHighlightedShape(this.settings.general.name,i.title),-1==this.highlightedShapes.indexOf(t)&&this.highlightedShapes.push(t)}},unhighlightShape:function(t){var e=this.settings.spots[t];if(-1==this.apiHighlightedShapes.indexOf(t)){this.applyStyles(e.default_style,t),$.imageMapProEventUnhighlightedShape(this.settings.general.name,e.title);var i=this.highlightedShapes.indexOf(t);this.highlightedShapes.splice(i,1)}},unhighlightAllShapes:function(){for(var t=this.highlightedShapes.slice(0),e=0;e<t.length;e++)this.unhighlightShape(t[e])},isShapeHighlighted:function(t){for(var e=0;e<this.highlightedShapes.length;e++)if(this.highlightedShapes[e]==t)return!0;return!1},performClickAction:function(i){var s=this.settings.spots[i];"follow-link"==s.actions.click&&(0==$("#imp-temp-link").length&&$("body").append('<a href="" id="imp-temp-link" target="_blank"></a>'),$("#imp-temp-link").attr("href",s.actions.link),1==parseInt(s.actions.open_link_in_new_window,10)?$("#imp-temp-link").attr("target","_blank"):$("#imp-temp-link").removeAttr("target"),$("#imp-temp-link")[0].click()),"run-script"==s.actions.click&&eval(s.actions.script.replace("<br>","")),$.imageMapProEventClickedShape(this.settings.general.name,this.settings.spots[i].title)},showTooltip:function(t,e){var i=this.settings.spots[t];if(""==i.connected_to||1!=parseInt(i.use_connected_shape_tooltip,10)){if(-1==this.openedTooltips.indexOf(t)){if(this.openedTooltips.length>0&&this.hideAllTooltips(),-1==this.openedTooltips.indexOf(t)&&this.openedTooltips.push(t),"mobile-only"==this.settings.tooltips.fullscreen_tooltips&&isMobile()||"always"==this.settings.tooltips.fullscreen_tooltips){this.visibleFullscreenTooltip=$('.imp-fullscreen-tooltip[data-index="'+t+'"]'),this.visibleFullscreenTooltipIndex=t,this.fullscreenTooltipsContainer.show();var s=this;setTimeout(function(){s.visibleFullscreenTooltip.addClass("imp-tooltip-visible")},20),this.fullscreenTooltipVisible=!0,this.bodyOverflow=$("body").css("overflow"),$("body").css({overflow:"hidden"})}else{var n=this.wrap.find('.imp-tooltip[data-index="'+t+'"]');n.show(),setTimeout(function(){n.addClass("imp-tooltip-visible")},1),this.measureTooltipSize(t),this.updateTooltipPosition(t,e)}$.imageMapProEventOpenedTooltip(this.settings.general.name,this.settings.spots[t].title)}}else{var o=this.getIndexOfShapeWithID(i.connected_to);this.showTooltip(o)}},hideTooltip:function(t){if(-1==this.apiOpenedTooltips.indexOf(t)){var e=this.openedTooltips.indexOf(t);if(this.openedTooltips.splice(e,1),"mobile-only"==this.settings.tooltips.fullscreen_tooltips&&isMobile()||"always"==this.settings.tooltips.fullscreen_tooltips){var i=this;setTimeout(function(){i.fullscreenTooltipsContainer.hide()},200),this.fullscreenTooltipVisible=!1,this.fullscreenTooltipsContainer.find('.imp-fullscreen-tooltip[data-index="'+t+'"]').removeClass("imp-tooltip-visible"),$("body").css({overflow:this.bodyOverflow})}else{var s=this.wrap.find('.imp-tooltip[data-index="'+t+'"]');s.removeClass("imp-tooltip-visible"),setTimeout(function(){s.hide()},200)}$.imageMapProEventClosedTooltip(this.settings.general.name,this.settings.spots[t].title)}},hideAllTooltips:function(){for(var t=this.openedTooltips.slice(0),e=0;e<t.length;e++)this.hideTooltip(t[e])},updateTooltipPosition:function(t,e){if(!this.fullscreenTooltipVisible){var i,s,n,o,a,p,l,h,r,d;if(i=this.wrap.find('.imp-tooltip[data-index="'+t+'"]'),s=i.data("imp-measured-width"),n=i.data("imp-measured-height"),d=this.settings.spots[t],1==parseInt(this.settings.tooltips.sticky_tooltips,10)&&e){var g=this.getEventCoordinates(e);h=g.x,r=g.y,o=h-this.wrap.offset().left,a=r-this.wrap.offset().top,p=0,l=0}else"spot"==d.type?(p=d.width,l=d.height,o=Math.round(10*d.x)/10/100*this.wrap.width()-p/2,a=Math.round(10*d.y)/10/100*this.wrap.height()-l/2):(p=d.width/100*this.wrap.width(),l=d.height/100*this.wrap.height(),o=Math.round(10*d.x)/10/100*this.wrap.width(),a=Math.round(10*d.y)/10/100*this.wrap.height());var c,u;"left"==d.tooltip_style.position&&(c=o-s-20,u=a+l/2-n/2),"right"==d.tooltip_style.position&&(c=o+p+20,u=a+l/2-n/2),"top"==d.tooltip_style.position&&(c=o+p/2-s/2,u=a-n-20),"bottom"==d.tooltip_style.position&&(c=o+p/2-s/2,u=a+l+20),"spot"==d.type&&1==parseInt(d.default_style.icon_is_pin,10)&&"spot"==d.type&&1==parseInt(d.default_style.use_icon,10)&&(u-=l/2);var f={x:c,y:u};if(1==parseInt(this.settings.tooltips.constrain_tooltips,10)){var m=this.wrap.offset().left-$(window).scrollLeft(),v=this.wrap.offset().top-$(window).scrollTop();(f=fitRectToScreen(c+m,u+v,s,n)).x-=m,f.y-=v}i.css({left:f.x,top:f.y})}},toggleFullscreen:function(){if(0==parseInt(this.settings.runtime.is_fullscreen,10)){$("body").addClass("imp-fullscreen-mode");var t=$.extend(!0,{},this.settings);t.runtime.is_fullscreen=1,t.id="999999",t.general.responsive=0;var e="";e+="background: "+this.settings.fullscreen.fullscreen_background,$("body").append('<div id="imp-fullscreen-wrap" style="'+e+'"><div id="image-map-pro-'+t.id+'"></div></div>'),$("#image-map-pro-"+t.id).imageMapPro(t),this.disableEvents(),fullscreenMap=this}else $("body").removeClass("imp-fullscreen-mode"),$("#imp-fullscreen-wrap").remove(),this.disableEvents(),fullscreenMap.events()}}),$.fn[pluginName]=function(t){return this.each(function(){$.data(this,"plugin_"+pluginName,new Plugin(this,t))})}}(jQuery,window,document);